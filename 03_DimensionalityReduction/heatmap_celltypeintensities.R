# Code creating heatmap showing cell intensities and inferred cell typessource("create_data.R")set.seed(20)library(ComplexHeatmap)t_cells = c("T-cells memory", "T-cells CD4+ (helper)", "T-cells mixed", "T-cells Naive", "T-cells")celltype_order <- order(celltypes$InferredCellType)cellType = celltypes$InferredCellType# Get the corresponding cell type labels in the same ordercelltype_labels <- celltypes$InferredCellType[celltype_order]# Plot the COMPLETE reordered heatmap with cell type labelsHeatmap(as.matrix(averages), name ="intensity", row_order = celltype_order,         row_split = cellType, row_title_rot = 0, column_title="Heatmap for R1B1ROI1 (raw intensities)",          show_column_dend = FALSE)  # Use cell type labels as row side color# Normalisation or not?averages_df = averages_scaled#averages_df = averages# separate t cells:averages_t = averages_df[celltypes$InferredCellType %in% t_cells, ]celltypes_t = celltypes[celltypes$InferredCellType %in% t_cells, ]celltype_order_t <- order(celltypes_t$InferredCellType)cellType_t = celltypes_t$InferredCellTypeHeatmap(as.matrix(averages_t), name ="intensity", row_order = celltype_order_t,         row_split = cellType_t, row_title_rot = 0, column_title="Heatmap for R1B1ROI1 (raw intensities)",          show_column_dend = FALSE, show_row_dend = FALSE, show_row_names = FALSE)  # Use cell type labels as row side orderaverages_nott = averages_df[!(celltypes$InferredCellType %in% t_cells), ]celltypes_nott = celltypes[!(celltypes$InferredCellType %in% t_cells), ]celltype_order_nott <- order(celltypes_nott$InferredCellType)cellType_nott = celltypes_nott$InferredCellTypeHeatmap(as.matrix(averages_nott), name ="intensity", row_order = celltype_order_nott,         row_split = cellType_nott, row_title_rot = 0, column_title="Heatmap for R1B1ROI1 (raw intensities)",          show_column_dend = FALSE, show_row_dend = FALSE, show_row_names = FALSE)  # Use cell type labels as row side order